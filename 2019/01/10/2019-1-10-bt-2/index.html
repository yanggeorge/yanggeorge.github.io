

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/icon-3-lambda.png">
  <link rel="icon" href="/images/icon-3-lambda.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Ming Yang">
  <meta name="keywords" content="">
  
    <meta name="description" content="如何获取下载源作为一个downloader开始下载资源首先要向tracker宣布自己的存在，同时获得其他downloader的地址。 这里的downloader我们统一称为对等节点（peer），因此接下来要做的事情就是与tracker通信，获取peers。">
<meta property="og:type" content="article">
<meta property="og:title" content="BitTorrent协议（二）之获取下载源">
<meta property="og:url" content="https://threelambda.com/2019/01/10/2019-1-10-bt-2/index.html">
<meta property="og:site_name" content="CodeCraft">
<meta property="og:description" content="如何获取下载源作为一个downloader开始下载资源首先要向tracker宣布自己的存在，同时获得其他downloader的地址。 这里的downloader我们统一称为对等节点（peer），因此接下来要做的事情就是与tracker通信，获取peers。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-01-09T16:00:00.000Z">
<meta property="article:modified_time" content="2024-07-22T07:16:58.457Z">
<meta property="article:author" content="alenym@qq.com">
<meta property="article:tag" content="bitTorrent">
<meta property="article:tag" content="protocol">
<meta property="article:tag" content="p2p">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>BitTorrent协议（二）之获取下载源 - CodeCraft</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="//at.alicdn.com/t/c/font_4629291_dx035s4nt6a.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"threelambda.com","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":80,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":"G-X6VGKB3GW8"},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=G-X6VGKB3GW8", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', 'G-X6VGKB3GW8');
        });
      }
    </script>
  

  

  

  

  



  
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>CodeCraft</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="https://threelambda.com/en/" target="_self">
                <i class="iconfont icon-language"></i>
                <span>English</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="BitTorrent协议（二）之获取下载源"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2019-01-10 00:00" pubdate>
          2019年1月10日 凌晨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          3.2k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          28 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">BitTorrent协议（二）之获取下载源</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="如何获取下载源"><a href="#如何获取下载源" class="headerlink" title="如何获取下载源"></a>如何获取下载源</h2><p>作为一个downloader开始下载资源首先要向tracker宣布自己的存在，同时获得其他downloader的地址。
这里的downloader我们统一称为对等节点（peer），因此接下来要做的事情就是与tracker通信，获取peers。</p>
<span id="more"></span>


<h2 id="获取下载源的协议"><a href="#获取下载源的协议" class="headerlink" title="获取下载源的协议"></a>获取下载源的协议</h2><p>有两种方法，</p>
<ul>
<li>方法一：基于HTTP的GET请求</li>
</ul>
<p>官网文档 <a target="_blank" rel="noopener" href="http://www.bittorrent.org/beps/bep_0003.html">BEP3</a> 中的trackers章节告诉我们可以使用HTTP &#x2F;GET
来得到peer的信息。也就是发送一个GET请求。</p>
<ul>
<li>方法二：基于UDP的tracker协议</li>
</ul>
<p>再对照如下tracker列表就可以明白了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://tracker.trackerfix.com:80/announce  <span class="hljs-comment"># 方法一</span><br><br>udp://9.rarbg.me:2710/announce  <span class="hljs-comment"># 方法二</span><br> <br>udp://9.rarbg.to:2710/announce <span class="hljs-comment"># 方法二</span><br></code></pre></td></tr></table></figure>

<p>方法一看起来是更简单的方法，但是在GFW保护下，这些采用方法一的服务端口都无法访问。因此只能尝试方法二。</p>
<h2 id="基于UDP的Tracker协议"><a href="#基于UDP的Tracker协议" class="headerlink" title="基于UDP的Tracker协议"></a>基于UDP的Tracker协议</h2><p>UDP协议本来也是一种更好的选择，因为传输的字节更少。官网文档<a target="_blank" rel="noopener" href="http://www.bittorrent.org/beps/bep_0015.html">UDP Tracker Protocol for BitTorrent</a>
详细说明了原因。</p>
<blockquote>
<p>Using HTTP introduces significant overhead. There’s overhead at the ethernet layer (14 bytes per packet), at the IP layer (20 bytes per packet), at the TCP layer (20 bytes per packet) and at the HTTP layer. About 10 packets are used for a request plus response containing 50 peers and the total number of bytes used is about 1206 [1]. This overhead can be reduced significantly by using a UDP based protocol. The protocol proposed here uses 4 packets and about 618 bytes, reducing traffic by 50%. For a client, saving 1 kbyte every hour isn’t significant, but for a tracker serving a million peers, reducing traffic by 50% matters a lot. An additional advantage is that a UDP based binary protocol doesn’t require a complex parser and no connection handling, reducing the complexity of tracker code and increasing it’s performance.</p>
</blockquote>
<p>简单来说就是方法一基于TCP的，每个基于TCP的请求的头部自然要比基于UDP的请求大。</p>
<p>UDP协议包含三个过程，</p>
<ul>
<li>CONNECT</li>
<li>ANNOUNCE</li>
<li>SCRAPE</li>
</ul>
<p>我们关心的是发布（ANNOUNCE），接下来重点看如何实现。</p>
<h2 id="实现发布"><a href="#实现发布" class="headerlink" title="实现发布"></a>实现发布</h2><p>两个步骤，</p>
<ul>
<li>CONNECT，获取connection_id</li>
<li>ANNOUNCE，拿着connection_id和info_hash等参数再请求。</li>
</ul>
<p>参考了<a target="_blank" rel="noopener" href="https://www.libtorrent.org/udp_tracker_protocol.html">Bittorrent udp-tracker protocol extension</a>
因为对入参和返回参数说明的更详细一些。用的tracker是一个热门的磁力链接。</p>
<pre><code class="hljs">ip = &#39;exodus.desync.com&#39;  # get from tracker list
port = 6969  # get from tracker list
</code></pre>
<p>而info_hash是用uTorrent软件打开该磁力链接后获得的。</p>
<pre><code class="hljs">1aa4c13830b822c1375686d685a9fce23405f6ba
</code></pre>
<p>以下是代码实现。uTorrent软件打开磁力链接会拿到tracker列表。</p>
<p>announce的重要参数说明</p>
<ol>
<li>num_want : -1  # 希望获得的peer个数，则是默认的peer个数</li>
<li>ip : 0  # 当前发送udp包的地址</li>
<li>port : 监听的公网端口</li>
</ol>
<p>一旦发布完成，该监听的端口会收到DHT协议的请求，例如FIND_NODE</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br>__author__ = <span class="hljs-string">&#x27;ym&#x27;</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    Date        : &#x27;2019/1/8&#x27;</span><br><span class="hljs-string">    Description :  udp tracker protocol</span><br><span class="hljs-string">    </span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> struct<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ip_me</span>():<br>    <span class="hljs-keyword">import</span> psutil<br>    <span class="hljs-keyword">import</span> socket<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_ip_addresses</span>(<span class="hljs-params">family</span>):<br>        <span class="hljs-keyword">for</span> interface, snics <span class="hljs-keyword">in</span> psutil.net_if_addrs().items():<br>            <span class="hljs-keyword">for</span> snic <span class="hljs-keyword">in</span> snics:<br>                <span class="hljs-keyword">if</span> snic.family == family:<br>                    <span class="hljs-keyword">yield</span> (interface, snic.address)<br><br>    addrs = <span class="hljs-built_in">list</span>(get_ip_addresses(socket.AF_INET))<br>    <span class="hljs-keyword">for</span> tup <span class="hljs-keyword">in</span> addrs:<br>        <span class="hljs-keyword">if</span> tup[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;en0&#x27;</span>:<br>            <span class="hljs-keyword">return</span> tup[<span class="hljs-number">1</span>]<br><br><br>SOURCE_IP = ip_me()<br>SOURCE_PORT = <span class="hljs-number">59876</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">to_byte</span>(<span class="hljs-params">integer, length=<span class="hljs-number">4</span></span>):<br>    <span class="hljs-keyword">return</span> integer.to_bytes(length, byteorder=<span class="hljs-string">&#x27;big&#x27;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">udp_send</span>(<span class="hljs-params">ip, port, data</span>):<br>    sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)  <span class="hljs-comment"># UDP</span><br>    sock.bind((SOURCE_IP, SOURCE_PORT))<br>    sock.sendto(data, (ip, port))<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">udp_recv</span>(<span class="hljs-params">ip, port</span>):<br>    sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)  <span class="hljs-comment"># UDP</span><br>    sock.bind((ip, port))<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        data, addr = sock.recvfrom(<span class="hljs-number">2048</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;received message:&quot;</span>, data)<br>        <span class="hljs-keyword">return</span> data<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UdpAnnouceRequest</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-variable language_">self</span>.connection_id = <span class="hljs-literal">None</span><br>        <span class="hljs-variable language_">self</span>.action = <span class="hljs-literal">None</span><br>        <span class="hljs-variable language_">self</span>.transaction_id = <span class="hljs-literal">None</span><br>        <span class="hljs-variable language_">self</span>.info_hash = <span class="hljs-literal">None</span><br>        <span class="hljs-variable language_">self</span>.peer_id = <span class="hljs-literal">None</span><br>        <span class="hljs-variable language_">self</span>.downloaded = <span class="hljs-literal">None</span><br>        <span class="hljs-variable language_">self</span>.left = <span class="hljs-literal">None</span><br>        <span class="hljs-variable language_">self</span>.uploaded = <span class="hljs-literal">None</span><br>        <span class="hljs-variable language_">self</span>.event = <span class="hljs-number">0</span><br>        <span class="hljs-variable language_">self</span>.ip = <span class="hljs-literal">None</span><br>        <span class="hljs-variable language_">self</span>.key = <span class="hljs-literal">None</span><br>        <span class="hljs-variable language_">self</span>.num_want = -<span class="hljs-number">1</span><br>        <span class="hljs-variable language_">self</span>.port = <span class="hljs-literal">None</span><br>        <span class="hljs-variable language_">self</span>.extensions = <span class="hljs-literal">None</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_bytes</span>(<span class="hljs-params">self</span>):<br>        result = to_byte(<span class="hljs-variable language_">self</span>.connection_id, <span class="hljs-number">8</span>)<br>        result += to_byte(<span class="hljs-variable language_">self</span>.action)<br>        result += to_byte(<span class="hljs-variable language_">self</span>.transaction_id)<br>        result += <span class="hljs-variable language_">self</span>.info_hash<br>        result += <span class="hljs-variable language_">self</span>.peer_id<br>        result += to_byte(<span class="hljs-variable language_">self</span>.downloaded, <span class="hljs-number">8</span>)<br>        result += to_byte(<span class="hljs-variable language_">self</span>.left, <span class="hljs-number">8</span>)<br>        result += to_byte(<span class="hljs-variable language_">self</span>.uploaded, <span class="hljs-number">8</span>)<br>        result += to_byte(<span class="hljs-variable language_">self</span>.event)<br>        result += to_byte(<span class="hljs-variable language_">self</span>.ip)<br>        result += to_byte(<span class="hljs-variable language_">self</span>.key)<br>        result += struct.pack(<span class="hljs-string">&quot;&gt;i&quot;</span>, <span class="hljs-variable language_">self</span>.num_want)<br>        result += to_byte(<span class="hljs-variable language_">self</span>.port, <span class="hljs-number">2</span>)<br>        <span class="hljs-keyword">return</span> result<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">udp_announcing</span>(<span class="hljs-params">request: UdpAnnouceRequest, dst_ip, dst_port</span>):<br>    data = request.get_bytes()<br>    udp_send(dst_ip, dst_port, data)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">connect</span>(<span class="hljs-params">tracker_ip, tracker_port</span>):<br>    protocol_id = <span class="hljs-number">0x41727101980</span>  <span class="hljs-comment"># magic number</span><br>    action = <span class="hljs-number">0</span>  <span class="hljs-comment"># connect</span><br>    transaction_id = <span class="hljs-number">123</span>  <span class="hljs-comment"># random</span><br><br>    data = struct.pack(<span class="hljs-string">&quot;&gt;Qii&quot;</span>, protocol_id, action, transaction_id)<br>    udp_send(tracker_ip, tracker_port, data)<br><br>    reply = udp_recv(SOURCE_IP, SOURCE_PORT)<br>    action, transaction_id, connection_id = struct.unpack(<span class="hljs-string">&quot;&gt;iiQ&quot;</span>, reply)<br>    fmt = <span class="hljs-string">&quot;connect reply:\n\taction:&#123;&#125;, transaction_id:&#123;&#125;, connection_id:&#123;&#125;&quot;</span><br>    <span class="hljs-built_in">print</span>(fmt.<span class="hljs-built_in">format</span>(action, transaction_id, connection_id))<br>    <span class="hljs-keyword">return</span> connection_id<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">announce</span>(<span class="hljs-params">connection_id, dst_ip, dst_port</span>):<br>    request = UdpAnnouceRequest()<br>    request.connection_id = connection_id<br>    request.action = <span class="hljs-number">1</span><br>    request.transaction_id = <span class="hljs-number">1234</span>  <span class="hljs-comment"># random</span><br>    request.info_hash = <span class="hljs-built_in">bytearray</span>.fromhex(<span class="hljs-string">&#x27;1aa4c13830b822c1375686d685a9fce23405f6ba&#x27;</span>)  <span class="hljs-comment"># compute from meta_info</span><br>    request.peer_id = <span class="hljs-built_in">bytearray</span>.fromhex(<span class="hljs-string">&#x27;ab&#x27;</span> * <span class="hljs-number">20</span>)  <span class="hljs-comment"># random</span><br>    request.downloaded = <span class="hljs-number">0</span><br>    request.left = <span class="hljs-number">1509949440</span>  <span class="hljs-comment"># from meta_info</span><br>    request.uploaded = <span class="hljs-number">0</span><br>    request.ip = <span class="hljs-number">0</span>  <span class="hljs-comment"># default</span><br>    request.key = <span class="hljs-number">314</span><br>    request.port = <span class="hljs-number">59601</span>  <span class="hljs-comment">#</span><br>    <span class="hljs-comment"># print(request)</span><br>    udp_announcing(request, dst_ip, dst_port)<br>    <span class="hljs-keyword">return</span> udp_recv(SOURCE_IP, SOURCE_PORT)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">udp_process</span>():<br>    ip = <span class="hljs-string">&#x27;exodus.desync.com&#x27;</span>  <span class="hljs-comment"># get from tracker list</span><br>    port = <span class="hljs-number">6969</span>  <span class="hljs-comment"># get from tracker list</span><br>    connection_id = connect(ip, port)<br>    reply = announce(connection_id, ip, port)<br>    action, transaction_id, interval, leechers, seeders = struct.unpack(<span class="hljs-string">&quot;&gt;iiiii&quot;</span>, reply[<span class="hljs-number">0</span>:<span class="hljs-number">20</span>])<br>    fmt = <span class="hljs-string">&quot;announce_reply:\n\taction:&#123;&#125;, transaction_id:&#123;&#125;, interval:&#123;&#125;s, leechers:&#123;&#125;, seeders:&#123;&#125;&quot;</span><br>    <span class="hljs-built_in">print</span>(fmt.<span class="hljs-built_in">format</span>(action, transaction_id, interval, leechers, seeders))<br>    peers = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">20</span>, <span class="hljs-built_in">len</span>(reply), <span class="hljs-number">6</span>):<br>        <span class="hljs-keyword">if</span> i + <span class="hljs-number">6</span> &lt;= <span class="hljs-built_in">len</span>(reply):<br>            data = reply[i:i + <span class="hljs-number">6</span>]<br>            n1, n2, n3, n4, peer_port = struct.unpack(<span class="hljs-string">&quot;&gt;BBBBH&quot;</span>, data)<br>            peer_ip = <span class="hljs-string">&quot;&#123;&#125;.&#123;&#125;.&#123;&#125;.&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(n1, n2, n3, n4)<br>            peers.append((peer_ip, peer_port))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;get &#123;&#125; peers:&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">len</span>(peers), peers))<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    udp_process()<br></code></pre></td></tr></table></figure>

<h2 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h2><p>运行日志如下，可以看到拿到了200个peers的ipv4地址和端口。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/bin/</span>python3.<span class="hljs-number">7</span> <span class="hljs-regexp">/Users/ym</span><span class="hljs-regexp">/charm/</span>pytest<span class="hljs-regexp">/ym/</span>bt/udp_announce.py<br>received message: <span class="hljs-string">b&#x27;\x00\x00\x00\x00\x00\x00\x00&#123;\xd89\xa8\x9dv\xd3=]&#x27;</span><br>connect reply:<br>	action:<span class="hljs-number">0</span>, transaction_id:<span class="hljs-number">123</span>, connection_id:<span class="hljs-number">15580669780121828701</span><br>received message: <span class="hljs-string">b&#x27;\x00\x00\x00\x01\x00\x00\x04\xd2\x00\x00\x07_\x00\x00\x00%\x00\x00\x01qi\xe8\xff\xd8XWl\x18-F\xbcd\x9e\xae&#125;\xea\xaa[\xd41S\&#x27;\xcb\x0eb\x14\x8f\xcfbcg\xcd\xaf9\xe0\x1f-\xf7*\xa6\xa2\x86)P\xadl\xbc\xbf)\xb6&#123;\xc4w\xaa)\xcd\xf0@cF--;M\xa6Wp\xce\xc7\xff\xfc\xcf\xbb\x9e\x18\x9c\xec\x96\xc4\xcf\x83PS\x06_\xb4zmc\xd3\x82i\xef\x0b\xeb\xd0\xaf ~d\xf3\x8c\xde\x9b?\xfc\xdb!1\x93W\x0b\xc3I\xad\xf4,)\xf0\x1c\xc5\xe0\x98\x80\xbbZ\xb4^UA#\&#x27;|\x95\x7fd\xc77p\xc8Z\xadN\xb5p\xc7K\xbc\xd31i\x9c\xe0\x7f0\xaeV\x02\xc2\xe3G.R\x92\xfc\x15\xc8\x05R\x18\x18I\x943H3~\r\xd3\x89=\x06\xe6\xbb86-y\xd1\xa6\xca\xcb)\xd7\r\x8aLo)\xcb\xda\x8e;K)Z&lt;\x9c\xb0\x87);Q\xd0\xb2\x8b\x18\xa5\xc2T\xb8\xd7\x05\x90;\x83\xf1^\xca\x8eeB\xa1a\xb9\xe8\x15z\x83\xde\x93\n\xba\x91+\x9em\xb1\x9b\xd0V\x82Y\xf2\xb5\xad\xc7\rV\x06\xf8^k\x14R\x8eP\xb1\xfb\x15Rf\x1eV\xd0\x05R-\xd9\xf5\xc2&quot;@\x86\xf0K\x00\x00@B\xdeFa*\x1f;\x02&lt;\xa2\xa7\x18l\xed\xfa\xd2\xf4\x05k#\x81\xe8\xa5\x01\xban\x82\xcd\t\xd57\xb8\x8eQ\xdd\xd4\x1b\x13\xfalh\xd0\x83\xa5J\xa9\xb5\xce\xe7x:\xb8\xe1\xc9\xab\xc6\xf9\xa3:\xc5\xed\xc5\xe4\xd2c\xb6\xb9\x1cL\xc0\x19\x8b&lt;\xbfn\x9a\xc2\x80\xcc\xf3\xc3?\xefn\x8dg\xa5=\x0cm\xb1^\xfcU\xf3[&#125;\xdd\x90\x82yS\xe9o\xf3\xf0R@w\xc0\xf4\&#x27;\xae\xd0SR\xcc\xde@\xc5\xf8\xdb\x9e\x8a\x0f\xb3\x08_\x90\xb4\xc1\xa9=\xda$\x1a\xe1n\xe8V\r\xe5\xe1b\x8cr&#123;1\xc3^\x05\xe8bR\x00Sn\xe5\x7fe\xe5G4V5I \x1bjQ\x9a\x80\x7f\xce\xe7y\xd5\xde]\xbc\x81D\xbd\xbf\xf1\xb8K\xdfZ\x8d\xe5\xa9=\xda#\x1a\xe1sE\xbb\xb8\xd4Oi\xa7\x10V\xe9\xffgG\x10\xf3\x8f\xde^\xea#S+%\\\xeeN_\xba\xbd3\x07g\xaf\xdb\xb3)\xa1:#\xe0G%\x98\xce\x84&#125;\xe2\xd8ch\xeaN\xb2\xbe\xabp\xe3\xd2?\xb7\r\xcd\x9d\xf3\x8c\xa8\x01\x18I\xabH\x90\x84,A\x9a\x02&#125;\xd1\\\xdd\x94bp\x8d:\xa7e:p\n\x17\x93\xb0\xb9h\x05\xa9)b\xdc\\\xed\x0f;]\x9dX\x10\x96\x98u\x92R\x18\x8a+\xc2LR\x0cH\xa7z\x06&gt;\x96OI2\x9f.\xb6\xbax9\xee)\xbaS\x8b\x9b\x81)\x8b\xfa&amp;m,)P\xe4\x95\xc8s%\x8e\x03+&gt;\x1e\xc5\xf8\x92\xba\xb9\xca\xc4\xca\xa9\xba\xd3(\xc3Yxr\x07_\xbe:\x08\x08\xc8\x9c\xb2P\x14X\x7f\xcf\x9aIWU\xc6G\x80j\xa0\x9dRSx\xf4n\x07w\xe4m\xbe\xd4`\xc8\xd5g\xf4\xf2&#125;\xe1\x01g5I%\xc1\xa1\\c@\x89\x99\x9bVSE\x95\xfb\xdeV\x12\xe0F\&#x27;gR\x17n\x90\x91\xf4O\xb7c\xa6\xd1\xfcOC9\xf0s\xee+\xf6\xc8u\xe1\xed+\xf1\x91DGD)Zo\x9e\xf3y\x18\xcb\x97\x9e=\&#x27;\xc4\xca\xa9\xba\xcbO\xa5\xe7(\x0e8\xc1\xa2\xf6k\x92\x14\x82q\x14b.\xe7oi\xe8X\x86\xe2\xbagF\xcc\xc2\xed\x83`+\xbdk\x99\xdfR\x07u\xa2\xbf\x8cBW\xcfc\x00\x00?\x8f\xecq\x00\x00)\xd2\n\xe3\xe9\xca\x1f-g\x8a\xe5y\xde\xb8\xe8\xad\xab\xc4\xd8\x97\xb8\x9f\xd0d\xd0g\xe9\xa2\xdb\xbd\xc4\xd1\xe9\xa4\x86\xc2\xc4\xcf\xb83\xe2\xaa\xc3\x93\xb5\xbe&amp;\xfb\x9c\xde.\xdc\xd2\x14\x9aF9B\xa4&#123;p\xcd\x9d\xf6\xe0\xcai\xb8\x99u\xf0+g&#123;$\xb5\xb3LZ\xdbs\xab\x99~Qd\xff\xdf\xe8\xefP\&#x27;\x86\xc9:\x8aMD\xf3F\x88\xb8H\xe5%G\x84M1\x92\r~\xe9\x13)OB\xe1Vi\xdd\xcb\x16\xf53\xb3\xba\x96\x86\xaf\xba:\xb2\xa6!$\x7f\xdd|k\xc0+\x8a&#125;&#123;\xf5\x14\x8eAVy68&amp;K\xb1tZ`\nY\xb8l\x04\xd7\xfb\x84\xb3h\xcfSb*\x93`\x17\xb5[\xebGV\x89\x15S\x91\xd1KA\xd7\xc4\xa3o?\xf5:\x9b\x83\x1d.\xd1,c\x05\x16\xb6\xba\xfd\xab97\xb2\x9d\xf9&gt;g\xeb\x82i\xa4&#123;G\xb7i\xe8V1\x91\xafg\xfc\xca\x96\xaf\x16g\x04\xf8\x8a\xda!_^\x9d\xaf\xd2-^\xaf\x94\x0c\xbc\x0f^L\x0f,\xc3\x00Y\xedbW\xf5\x84WFe\xc7\xaeAV\x19|\x9e\xb0\xcfH\xe6\xda\x88&lt;\xdcFA\xe3\x15q\x08)\x8b\xf3:L\x1b)&lt;\xe9\xf5\xaa[\x1f\xd7\x0e\x08Z\xb2\x01\t\x87,R\xd9\xcb\xd4\x9bSx&quot;\xca\x8e[f`N\xc5\xed\x81\x96b\xdc\xc5\xe8\x1av#\&#x27;\xc5\xe8\x13n\xdbn\xc4\xf9g\xc4:\x15\xbbp|\xa6#\&#x27;\xb7W\xa9\x9b@5u\xc2\xdcQd\xef&#x27;</span><br>announce_reply:<br>	action:<span class="hljs-number">1</span>, transaction_id:<span class="hljs-number">1234</span>, interval:<span class="hljs-number">1887</span>s, leechers:<span class="hljs-number">37</span>, seeders:<span class="hljs-number">369</span><br>get <span class="hljs-number">200</span> peers:[(<span class="hljs-string">&#x27;105.232.255.216&#x27;</span>, <span class="hljs-number">22615</span>), (<span class="hljs-string">&#x27;108.24.45.70&#x27;</span>, <span class="hljs-number">48228</span>), (<span class="hljs-string">&#x27;158.174.125.234&#x27;</span>, <span class="hljs-number">43611</span>), (<span class="hljs-string">&#x27;212.49.83.39&#x27;</span>, <span class="hljs-number">51982</span>), (<span class="hljs-string">&#x27;98.20.143.207&#x27;</span>, <span class="hljs-number">25187</span>), (<span class="hljs-string">&#x27;103.205.175.57&#x27;</span>, <span class="hljs-number">57375</span>), (<span class="hljs-string">&#x27;45.247.42.166&#x27;</span>, <span class="hljs-number">41606</span>), (<span class="hljs-string">&#x27;41.80.173.108&#x27;</span>, <span class="hljs-number">48319</span>), (<span class="hljs-string">&#x27;41.182.123.196&#x27;</span>, <span class="hljs-number">30634</span>), (<span class="hljs-string">&#x27;41.205.240.64&#x27;</span>, <span class="hljs-number">25414</span>), (<span class="hljs-string">&#x27;45.45.59.77&#x27;</span>, <span class="hljs-number">42583</span>), (<span class="hljs-string">&#x27;112.206.199.255&#x27;</span>, <span class="hljs-number">64719</span>), (<span class="hljs-string">&#x27;187.158.24.156&#x27;</span>, <span class="hljs-number">60566</span>), (<span class="hljs-string">&#x27;196.207.131.80&#x27;</span>, <span class="hljs-number">21254</span>), (<span class="hljs-string">&#x27;95.180.122.109&#x27;</span>, <span class="hljs-number">25555</span>), (<span class="hljs-string">&#x27;130.105.239.11&#x27;</span>, <span class="hljs-number">60368</span>), (<span class="hljs-string">&#x27;175.32.126.100&#x27;</span>, <span class="hljs-number">62348</span>), (<span class="hljs-string">&#x27;222.155.63.252&#x27;</span>, <span class="hljs-number">56097</span>), (<span class="hljs-string">&#x27;49.147.87.11&#x27;</span>, <span class="hljs-number">49993</span>), (<span class="hljs-string">&#x27;173.244.44.41&#x27;</span>, <span class="hljs-number">61468</span>), (<span class="hljs-string">&#x27;197.224.152.128&#x27;</span>, <span class="hljs-number">47962</span>), (<span class="hljs-string">&#x27;180.94.85.65&#x27;</span>, <span class="hljs-number">8999</span>), (<span class="hljs-string">&#x27;124.149.127.100&#x27;</span>, <span class="hljs-number">50999</span>), (<span class="hljs-string">&#x27;112.200.90.173&#x27;</span>, <span class="hljs-number">20149</span>), (<span class="hljs-string">&#x27;112.199.75.188&#x27;</span>, <span class="hljs-number">54065</span>), (<span class="hljs-string">&#x27;105.156.224.127&#x27;</span>, <span class="hljs-number">12462</span>), (<span class="hljs-string">&#x27;86.2.194.227&#x27;</span>, <span class="hljs-number">18222</span>), (<span class="hljs-string">&#x27;82.146.252.21&#x27;</span>, <span class="hljs-number">51205</span>), (<span class="hljs-string">&#x27;82.24.24.73&#x27;</span>, <span class="hljs-number">37939</span>), (<span class="hljs-string">&#x27;72.51.126.13&#x27;</span>, <span class="hljs-number">54153</span>), (<span class="hljs-string">&#x27;61.6.230.187&#x27;</span>, <span class="hljs-number">14390</span>), (<span class="hljs-string">&#x27;45.121.209.166&#x27;</span>, <span class="hljs-number">51915</span>), (<span class="hljs-string">&#x27;41.215.13.138&#x27;</span>, <span class="hljs-number">19567</span>), (<span class="hljs-string">&#x27;41.203.218.142&#x27;</span>, <span class="hljs-number">15179</span>), (<span class="hljs-string">&#x27;41.90.60.156&#x27;</span>, <span class="hljs-number">45191</span>), (<span class="hljs-string">&#x27;41.59.81.208&#x27;</span>, <span class="hljs-number">45707</span>), (<span class="hljs-string">&#x27;24.165.194.84&#x27;</span>, <span class="hljs-number">47319</span>), (<span class="hljs-string">&#x27;5.144.59.131&#x27;</span>, <span class="hljs-number">61790</span>), (<span class="hljs-string">&#x27;202.142.101.66&#x27;</span>, <span class="hljs-number">41313</span>), (<span class="hljs-string">&#x27;185.232.21.122&#x27;</span>, <span class="hljs-number">33758</span>), (<span class="hljs-string">&#x27;147.10.186.145&#x27;</span>, <span class="hljs-number">11166</span>), (<span class="hljs-string">&#x27;109.177.155.208&#x27;</span>, <span class="hljs-number">22146</span>), (<span class="hljs-string">&#x27;89.242.181.173&#x27;</span>, <span class="hljs-number">50957</span>), (<span class="hljs-string">&#x27;86.6.248.94&#x27;</span>, <span class="hljs-number">27412</span>), (<span class="hljs-string">&#x27;82.142.80.177&#x27;</span>, <span class="hljs-number">64277</span>), (<span class="hljs-string">&#x27;82.102.30.86&#x27;</span>, <span class="hljs-number">53253</span>), (<span class="hljs-string">&#x27;82.45.217.245&#x27;</span>, <span class="hljs-number">49698</span>), (<span class="hljs-string">&#x27;64.134.240.75&#x27;</span>, <span class="hljs-number">0</span>), (<span class="hljs-string">&#x27;64.66.222.70&#x27;</span>, <span class="hljs-number">24874</span>), (<span class="hljs-string">&#x27;31.59.2.60&#x27;</span>, <span class="hljs-number">41639</span>), (<span class="hljs-string">&#x27;24.108.237.250&#x27;</span>, <span class="hljs-number">54004</span>), (<span class="hljs-string">&#x27;5.107.35.129&#x27;</span>, <span class="hljs-number">59557</span>), (<span class="hljs-string">&#x27;1.186.110.130&#x27;</span>, <span class="hljs-number">52489</span>), (<span class="hljs-string">&#x27;213.55.184.142&#x27;</span>, <span class="hljs-number">20957</span>), (<span class="hljs-string">&#x27;212.27.19.250&#x27;</span>, <span class="hljs-number">27752</span>), (<span class="hljs-string">&#x27;208.131.165.74&#x27;</span>, <span class="hljs-number">43445</span>), (<span class="hljs-string">&#x27;206.231.120.58&#x27;</span>, <span class="hljs-number">47329</span>), (<span class="hljs-string">&#x27;201.171.198.249&#x27;</span>, <span class="hljs-number">41786</span>), (<span class="hljs-string">&#x27;197.237.197.228&#x27;</span>, <span class="hljs-number">53859</span>), (<span class="hljs-string">&#x27;182.185.28.76&#x27;</span>, <span class="hljs-number">49177</span>), (<span class="hljs-string">&#x27;139.60.191.110&#x27;</span>, <span class="hljs-number">39618</span>), (<span class="hljs-string">&#x27;128.204.243.195&#x27;</span>, <span class="hljs-number">16367</span>), (<span class="hljs-string">&#x27;110.141.103.165&#x27;</span>, <span class="hljs-number">15628</span>), (<span class="hljs-string">&#x27;109.177.94.252&#x27;</span>, <span class="hljs-number">22003</span>), (<span class="hljs-string">&#x27;91.125.221.144&#x27;</span>, <span class="hljs-number">33401</span>), (<span class="hljs-string">&#x27;83.233.111.243&#x27;</span>, <span class="hljs-number">61522</span>), (<span class="hljs-string">&#x27;64.119.192.244&#x27;</span>, <span class="hljs-number">10158</span>), (<span class="hljs-string">&#x27;208.83.82.204&#x27;</span>, <span class="hljs-number">56896</span>), (<span class="hljs-string">&#x27;197.248.219.158&#x27;</span>, <span class="hljs-number">35343</span>), (<span class="hljs-string">&#x27;179.8.95.144&#x27;</span>, <span class="hljs-number">46273</span>), (<span class="hljs-string">&#x27;169.61.218.36&#x27;</span>, <span class="hljs-number">6881</span>), (<span class="hljs-string">&#x27;110.232.86.13&#x27;</span>, <span class="hljs-number">58849</span>), (<span class="hljs-string">&#x27;98.140.114.123&#x27;</span>, <span class="hljs-number">12739</span>), (<span class="hljs-string">&#x27;94.5.232.98&#x27;</span>, <span class="hljs-number">20992</span>), (<span class="hljs-string">&#x27;83.110.229.127&#x27;</span>, <span class="hljs-number">26085</span>), (<span class="hljs-string">&#x27;71.52.86.53&#x27;</span>, <span class="hljs-number">18720</span>), (<span class="hljs-string">&#x27;27.106.81.154&#x27;</span>, <span class="hljs-number">32895</span>), (<span class="hljs-string">&#x27;206.231.121.213&#x27;</span>, <span class="hljs-number">56925</span>), (<span class="hljs-string">&#x27;188.129.68.189&#x27;</span>, <span class="hljs-number">49137</span>), (<span class="hljs-string">&#x27;184.75.223.90&#x27;</span>, <span class="hljs-number">36325</span>), (<span class="hljs-string">&#x27;169.61.218.35&#x27;</span>, <span class="hljs-number">6881</span>), (<span class="hljs-string">&#x27;115.69.187.184&#x27;</span>, <span class="hljs-number">54351</span>), (<span class="hljs-string">&#x27;105.167.16.86&#x27;</span>, <span class="hljs-number">59903</span>), (<span class="hljs-string">&#x27;103.71.16.243&#x27;</span>, <span class="hljs-number">36830</span>), (<span class="hljs-string">&#x27;94.234.35.83&#x27;</span>, <span class="hljs-number">11045</span>), (<span class="hljs-string">&#x27;92.238.78.95&#x27;</span>, <span class="hljs-number">47805</span>), (<span class="hljs-string">&#x27;51.7.103.175&#x27;</span>, <span class="hljs-number">56243</span>), (<span class="hljs-string">&#x27;41.161.58.35&#x27;</span>, <span class="hljs-number">57415</span>), (<span class="hljs-string">&#x27;37.152.206.132&#x27;</span>, <span class="hljs-number">32226</span>), (<span class="hljs-string">&#x27;216.99.104.234&#x27;</span>, <span class="hljs-number">20146</span>), (<span class="hljs-string">&#x27;190.171.112.227&#x27;</span>, <span class="hljs-number">53823</span>), (<span class="hljs-string">&#x27;183.13.205.157&#x27;</span>, <span class="hljs-number">62348</span>), (<span class="hljs-string">&#x27;168.1.24.73&#x27;</span>, <span class="hljs-number">43848</span>), (<span class="hljs-string">&#x27;144.132.44.65&#x27;</span>, <span class="hljs-number">39426</span>), (<span class="hljs-string">&#x27;125.209.92.221&#x27;</span>, <span class="hljs-number">37986</span>), (<span class="hljs-string">&#x27;112.141.58.167&#x27;</span>, <span class="hljs-number">25914</span>), (<span class="hljs-string">&#x27;112.10.23.147&#x27;</span>, <span class="hljs-number">45241</span>), (<span class="hljs-string">&#x27;104.5.169.41&#x27;</span>, <span class="hljs-number">25308</span>), (<span class="hljs-string">&#x27;92.237.15.59&#x27;</span>, <span class="hljs-number">23965</span>), (<span class="hljs-string">&#x27;88.16.150.152&#x27;</span>, <span class="hljs-number">30098</span>), (<span class="hljs-string">&#x27;82.24.138.43&#x27;</span>, <span class="hljs-number">49740</span>), (<span class="hljs-string">&#x27;82.12.72.167&#x27;</span>, <span class="hljs-number">31238</span>), (<span class="hljs-string">&#x27;62.150.79.73&#x27;</span>, <span class="hljs-number">12959</span>), (<span class="hljs-string">&#x27;46.182.186.120&#x27;</span>, <span class="hljs-number">14830</span>), (<span class="hljs-string">&#x27;41.186.83.139&#x27;</span>, <span class="hljs-number">39809</span>), (<span class="hljs-string">&#x27;41.139.250.38&#x27;</span>, <span class="hljs-number">27948</span>), (<span class="hljs-string">&#x27;41.80.228.149&#x27;</span>, <span class="hljs-number">51315</span>), (<span class="hljs-string">&#x27;37.142.3.43&#x27;</span>, <span class="hljs-number">15902</span>), (<span class="hljs-string">&#x27;197.248.146.186&#x27;</span>, <span class="hljs-number">47562</span>), (<span class="hljs-string">&#x27;196.202.169.186&#x27;</span>, <span class="hljs-number">54056</span>), (<span class="hljs-string">&#x27;195.89.120.114&#x27;</span>, <span class="hljs-number">1887</span>), (<span class="hljs-string">&#x27;190.58.8.8&#x27;</span>, <span class="hljs-number">51356</span>), (<span class="hljs-string">&#x27;178.80.20.88&#x27;</span>, <span class="hljs-number">32719</span>), (<span class="hljs-string">&#x27;154.73.87.85&#x27;</span>, <span class="hljs-number">50759</span>), (<span class="hljs-string">&#x27;128.106.160.157&#x27;</span>, <span class="hljs-number">21075</span>), (<span class="hljs-string">&#x27;120.244.110.7&#x27;</span>, <span class="hljs-number">30692</span>), (<span class="hljs-string">&#x27;109.190.212.96&#x27;</span>, <span class="hljs-number">51413</span>), (<span class="hljs-string">&#x27;103.244.242.125&#x27;</span>, <span class="hljs-number">57601</span>), (<span class="hljs-string">&#x27;103.53.73.37&#x27;</span>, <span class="hljs-number">49569</span>), (<span class="hljs-string">&#x27;92.99.64.137&#x27;</span>, <span class="hljs-number">39323</span>), (<span class="hljs-string">&#x27;86.83.69.149&#x27;</span>, <span class="hljs-number">64478</span>), (<span class="hljs-string">&#x27;86.18.224.70&#x27;</span>, <span class="hljs-number">10087</span>), (<span class="hljs-string">&#x27;82.23.110.144&#x27;</span>, <span class="hljs-number">37364</span>), (<span class="hljs-string">&#x27;79.183.99.166&#x27;</span>, <span class="hljs-number">53756</span>), (<span class="hljs-string">&#x27;79.67.57.240&#x27;</span>, <span class="hljs-number">29678</span>), (<span class="hljs-string">&#x27;43.246.200.117&#x27;</span>, <span class="hljs-number">57837</span>), (<span class="hljs-string">&#x27;43.241.145.68&#x27;</span>, <span class="hljs-number">18244</span>), (<span class="hljs-string">&#x27;41.90.111.158&#x27;</span>, <span class="hljs-number">62329</span>), (<span class="hljs-string">&#x27;24.203.151.158&#x27;</span>, <span class="hljs-number">15655</span>), (<span class="hljs-string">&#x27;196.202.169.186&#x27;</span>, <span class="hljs-number">52047</span>), (<span class="hljs-string">&#x27;165.231.40.14&#x27;</span>, <span class="hljs-number">14529</span>), (<span class="hljs-string">&#x27;162.246.107.146&#x27;</span>, <span class="hljs-number">5250</span>), (<span class="hljs-string">&#x27;113.20.98.46&#x27;</span>, <span class="hljs-number">59247</span>), (<span class="hljs-string">&#x27;105.232.88.134&#x27;</span>, <span class="hljs-number">58042</span>), (<span class="hljs-string">&#x27;103.70.204.194&#x27;</span>, <span class="hljs-number">60803</span>), (<span class="hljs-string">&#x27;96.43.189.107&#x27;</span>, <span class="hljs-number">39391</span>), (<span class="hljs-string">&#x27;82.7.117.162&#x27;</span>, <span class="hljs-number">49036</span>), (<span class="hljs-string">&#x27;66.87.207.99&#x27;</span>, <span class="hljs-number">0</span>), (<span class="hljs-string">&#x27;63.143.236.113&#x27;</span>, <span class="hljs-number">0</span>), (<span class="hljs-string">&#x27;41.210.10.227&#x27;</span>, <span class="hljs-number">59850</span>), (<span class="hljs-string">&#x27;31.45.103.138&#x27;</span>, <span class="hljs-number">58745</span>), (<span class="hljs-string">&#x27;222.184.232.173&#x27;</span>, <span class="hljs-number">43972</span>), (<span class="hljs-string">&#x27;216.151.184.159&#x27;</span>, <span class="hljs-number">53348</span>), (<span class="hljs-string">&#x27;208.103.233.162&#x27;</span>, <span class="hljs-number">56253</span>), (<span class="hljs-string">&#x27;196.209.233.164&#x27;</span>, <span class="hljs-number">34498</span>), (<span class="hljs-string">&#x27;196.207.184.51&#x27;</span>, <span class="hljs-number">58026</span>), (<span class="hljs-string">&#x27;195.147.181.190&#x27;</span>, <span class="hljs-number">9979</span>), (<span class="hljs-string">&#x27;156.222.46.220&#x27;</span>, <span class="hljs-number">53780</span>), (<span class="hljs-string">&#x27;154.70.57.66&#x27;</span>, <span class="hljs-number">42107</span>), (<span class="hljs-string">&#x27;112.205.157.246&#x27;</span>, <span class="hljs-number">57546</span>), (<span class="hljs-string">&#x27;105.184.153.117&#x27;</span>, <span class="hljs-number">61483</span>), (<span class="hljs-string">&#x27;103.123.36.181&#x27;</span>, <span class="hljs-number">45900</span>), (<span class="hljs-string">&#x27;90.219.115.171&#x27;</span>, <span class="hljs-number">39294</span>), (<span class="hljs-string">&#x27;81.100.255.223&#x27;</span>, <span class="hljs-number">59631</span>), (<span class="hljs-string">&#x27;80.39.134.201&#x27;</span>, <span class="hljs-number">14986</span>), (<span class="hljs-string">&#x27;77.68.243.70&#x27;</span>, <span class="hljs-number">35000</span>), (<span class="hljs-string">&#x27;72.229.37.71&#x27;</span>, <span class="hljs-number">33869</span>), (<span class="hljs-string">&#x27;49.146.13.126&#x27;</span>, <span class="hljs-number">59667</span>), (<span class="hljs-string">&#x27;41.79.66.225&#x27;</span>, <span class="hljs-number">22121</span>), (<span class="hljs-string">&#x27;221.203.22.245&#x27;</span>, <span class="hljs-number">13235</span>), (<span class="hljs-string">&#x27;186.150.134.175&#x27;</span>, <span class="hljs-number">47674</span>), (<span class="hljs-string">&#x27;178.166.33.36&#x27;</span>, <span class="hljs-number">32733</span>), (<span class="hljs-string">&#x27;124.107.192.43&#x27;</span>, <span class="hljs-number">35453</span>), (<span class="hljs-string">&#x27;123.245.20.142&#x27;</span>, <span class="hljs-number">16726</span>), (<span class="hljs-string">&#x27;121.54.56.38&#x27;</span>, <span class="hljs-number">19377</span>), (<span class="hljs-string">&#x27;116.90.96.10&#x27;</span>, <span class="hljs-number">22968</span>), (<span class="hljs-string">&#x27;108.4.215.251&#x27;</span>, <span class="hljs-number">33971</span>), (<span class="hljs-string">&#x27;104.207.83.98&#x27;</span>, <span class="hljs-number">10899</span>), (<span class="hljs-string">&#x27;96.23.181.91&#x27;</span>, <span class="hljs-number">60231</span>), (<span class="hljs-string">&#x27;86.137.21.83&#x27;</span>, <span class="hljs-number">37329</span>), (<span class="hljs-string">&#x27;75.65.215.196&#x27;</span>, <span class="hljs-number">41839</span>), (<span class="hljs-string">&#x27;63.245.58.155&#x27;</span>, <span class="hljs-number">33565</span>), (<span class="hljs-string">&#x27;46.209.44.99&#x27;</span>, <span class="hljs-number">1302</span>), (<span class="hljs-string">&#x27;182.186.253.171&#x27;</span>, <span class="hljs-number">14647</span>), (<span class="hljs-string">&#x27;178.157.249.62&#x27;</span>, <span class="hljs-number">26603</span>), (<span class="hljs-string">&#x27;130.105.164.123&#x27;</span>, <span class="hljs-number">18359</span>), (<span class="hljs-string">&#x27;105.232.86.49&#x27;</span>, <span class="hljs-number">37295</span>), (<span class="hljs-string">&#x27;103.252.202.150&#x27;</span>, <span class="hljs-number">44822</span>), (<span class="hljs-string">&#x27;103.4.248.138&#x27;</span>, <span class="hljs-number">55841</span>), (<span class="hljs-string">&#x27;95.94.157.175&#x27;</span>, <span class="hljs-number">53805</span>), (<span class="hljs-string">&#x27;94.175.148.12&#x27;</span>, <span class="hljs-number">48143</span>), (<span class="hljs-string">&#x27;94.76.15.44&#x27;</span>, <span class="hljs-number">49920</span>), (<span class="hljs-string">&#x27;89.237.98.87&#x27;</span>, <span class="hljs-number">62852</span>), (<span class="hljs-string">&#x27;87.70.101.199&#x27;</span>, <span class="hljs-number">44609</span>), (<span class="hljs-string">&#x27;86.25.124.158&#x27;</span>, <span class="hljs-number">45263</span>), (<span class="hljs-string">&#x27;72.230.218.136&#x27;</span>, <span class="hljs-number">15580</span>), (<span class="hljs-string">&#x27;70.65.227.21&#x27;</span>, <span class="hljs-number">28936</span>), (<span class="hljs-string">&#x27;41.139.243.58&#x27;</span>, <span class="hljs-number">19483</span>), (<span class="hljs-string">&#x27;41.60.233.245&#x27;</span>, <span class="hljs-number">43611</span>), (<span class="hljs-string">&#x27;31.215.14.8&#x27;</span>, <span class="hljs-number">23218</span>), (<span class="hljs-string">&#x27;1.9.135.44&#x27;</span>, <span class="hljs-number">21209</span>), (<span class="hljs-string">&#x27;203.212.155.83&#x27;</span>, <span class="hljs-number">30754</span>), (<span class="hljs-string">&#x27;202.142.91.102&#x27;</span>, <span class="hljs-number">24654</span>), (<span class="hljs-string">&#x27;197.237.129.150&#x27;</span>, <span class="hljs-number">25308</span>), (<span class="hljs-string">&#x27;197.232.26.118&#x27;</span>, <span class="hljs-number">8999</span>), (<span class="hljs-string">&#x27;197.232.19.110&#x27;</span>, <span class="hljs-number">56174</span>), (<span class="hljs-string">&#x27;196.249.103.196&#x27;</span>, <span class="hljs-number">14869</span>), (<span class="hljs-string">&#x27;187.112.124.166&#x27;</span>, <span class="hljs-number">8999</span>), (<span class="hljs-string">&#x27;183.87.169.155&#x27;</span>, <span class="hljs-number">16437</span>), (<span class="hljs-string">&#x27;117.194.220.81&#x27;</span>, <span class="hljs-number">25839</span>)]<br><br>Process finished with <span class="hljs-keyword">exit</span> code <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/bitTorrent/" class="print-no-link">#bitTorrent</a>
      
        <a href="/tags/protocol/" class="print-no-link">#protocol</a>
      
        <a href="/tags/p2p/" class="print-no-link">#p2p</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>BitTorrent协议（二）之获取下载源</div>
      <div>https://threelambda.com/2019/01/10/2019-1-10-bt-2/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Ming Yang</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2019年1月10日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2019/01/21/2019-1-21-bt-3/" title="BitTorrent协议（三）之磁力链接获取元数据">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">BitTorrent协议（三）之磁力链接获取元数据</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2019/01/09/2019-1-9-bt-1/" title="BitTorrent协议（一）之解析种子文件">
                        <span class="hidden-mobile">BitTorrent协议（一）之解析种子文件</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
