<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>[leetcode 295]Find Median from Data Stream 原创解法</title>
  <meta name="description" content="目录">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="/leetcode/%E7%AE%97%E6%B3%95/python/2017/01/31/leetcode-295.html">
  <link rel="alternate" type="application/rss+xml" title="3.λ｜形而下技术博客" href="/feed.xml">
  
  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-102303390-1', 'auto');
  ga('send', 'pageview');

</script>

  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">

    <a class="site-title" href="/">3.λ｜形而下技术博客</a>

    <nav class="site-nav">
      <span class="menu-icon">
        <svg viewBox="0 0 18 15" width="18px" height="15px">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </span>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">关于作者</a>
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">[leetcode 295]Find Median from Data Stream 原创解法</h1>
    <p class="post-meta"><time datetime="2017-01-31T00:00:00+00:00" itemprop="datePublished">Jan 31, 2017</time> • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">alenym@qq.com</span></span></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <h2 id="目录">目录</h2>

<ul>
  <li><a href="#hh0">题目概述</a></li>
  <li><a href="#hh1">第一想到的解法</a></li>
  <li><a href="#hh2">使用链表</a></li>
  <li><a href="#hh3">最终解法要用堆</a></li>
  <li><a href="#hh4">吐槽</a></li>
</ul>

<h2 id="-题目概述"><a name="hh0"></a> 题目概述</h2>

<p> 
 
 
 
<a href="https://leetcode.com/problems/find-median-from-data-stream/">原题链接</a></p>

<blockquote>
  <p>Median is the middle value in an ordered integer list. If the size of the list is even, there is no middle value. So the median is the mean of the two middle value.</p>

  <p>Examples: 
 <code class="highlighter-rouge">[2,3,4]</code> , the median is 3</p>

  <p><code class="highlighter-rouge">[2,3]</code>, the median is (2 + 3) / 2 = 2.5</p>

  <p>Design a data structure that supports the following two operations:</p>

  <ul>
    <li>void addNum(int num) - Add a integer number from the data stream to the data structure.</li>
    <li>double findMedian() - Return the median of all elements so far.</li>
  </ul>

  <p>For example:</p>
</blockquote>

<div class="highlighter-rouge"><pre class="highlight"><code>addNum(1)
addNum(2)
findMedian() -&gt; 1.5
addNum(3) 
findMedian() -&gt; 2
</code></pre>
</div>

<h2 id="-第一想到的解法"><a name="hh1"></a> 第一想到的解法</h2>

<p> 
 
 
 
找到一串数字的中位数，那么首先要对数字进行排列。否则怎么知道哪个
数字是处于中间的呢。快排是不行的，因为快排是一个离线算法。必须要
读进所有的数字。总不能每增加一个数做一次快排吧。
插入排序是一种在线算法，每增加一个数字遍历一遍就好。
那就实现一下吧。以下是实现的解法。但是超时了。</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></td><td class="code"><pre> 
<span class="c">#python3</span>
<span class="k">class</span> <span class="nc">MedianFinder</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        initialize your data structure here.
        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">addNum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="s">"""
        :type num: int
        :rtype: void
        """</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">num</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">findMedian</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        :rtype: float
        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span>
            <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">mid</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">2</span>
                <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">[</span><span class="n">mid</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">[</span><span class="n">mid</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">[</span><span class="n">mid</span><span class="p">]</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h2 id="-使用链表"><a name="hh2"></a> 使用链表</h2>
<p> 
 
 
 
这个方法再插入一个数字的时间复杂度也是<code class="highlighter-rouge">O(n)</code>，所以如果我们不使用
python的<code class="highlighter-rouge">list</code>而是使用一个自己创建的链表，那么插入的时间复杂度
是<code class="highlighter-rouge">O(1)</code>至少应该快一些。嗯，重新实现一遍。以下是实现的代码，但是
还是超时了。而且速度和前一种相当。说明python内置的<code class="highlighter-rouge">list</code>效率是相当
高的。</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82</pre></td><td class="code"><pre> 
<span class="c"># python3</span>
<span class="k">class</span> <span class="nc">Linker</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pre</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">v</span>
        <span class="bp">self</span><span class="o">.</span><span class="nb">next</span> <span class="o">=</span> <span class="bp">None</span>


<span class="k">class</span> <span class="nc">MedianFinder1</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        initialize your data structure here.
        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">median</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">odd</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">addNum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="s">"""
        :type num: int
        :rtype: void
        """</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">Linker</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mid_next</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">odd</span> <span class="o">=</span> <span class="bp">True</span>  <span class="c"># 是否增加了计数个</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">odd</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">odd</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span>
            <span class="n">tmp_next</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">while</span> <span class="n">tmp</span> <span class="ow">and</span> <span class="n">tmp</span><span class="o">.</span><span class="n">v</span> <span class="o">&gt;</span> <span class="n">num</span><span class="p">:</span> 
                <span class="n">tmp_next</span> <span class="o">=</span> <span class="n">tmp</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">pre</span>

            <span class="n">linker</span> <span class="o">=</span> <span class="n">Linker</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tmp_next</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">linker</span>

            <span class="k">if</span> <span class="n">tmp</span> <span class="ow">and</span> <span class="n">tmp_next</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">tmp</span><span class="o">.</span><span class="nb">next</span> <span class="o">=</span> <span class="n">linker</span>
                <span class="n">linker</span><span class="o">.</span><span class="n">pre</span> <span class="o">=</span> <span class="n">tmp</span>
            <span class="k">elif</span> <span class="n">tmp</span> <span class="ow">and</span> <span class="n">tmp_next</span><span class="p">:</span>
                <span class="n">tmp</span><span class="o">.</span><span class="nb">next</span> <span class="o">=</span> <span class="n">linker</span>
                <span class="n">linker</span><span class="o">.</span><span class="n">pre</span> <span class="o">=</span> <span class="n">tmp</span>
                <span class="n">linker</span><span class="o">.</span><span class="nb">next</span> <span class="o">=</span> <span class="n">tmp_next</span>
                <span class="n">tmp_next</span><span class="o">.</span><span class="n">pre</span> <span class="o">=</span> <span class="n">linker</span>
            <span class="k">elif</span> <span class="n">tmp</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">tmp_next</span><span class="p">:</span>
                <span class="n">linker</span><span class="o">.</span><span class="nb">next</span> <span class="o">=</span> <span class="n">tmp_next</span>
                <span class="n">tmp_next</span><span class="o">.</span><span class="n">pre</span> <span class="o">=</span> <span class="n">linker</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">odd</span><span class="p">:</span>
                <span class="c"># 从两个中位数变为一个</span>
                <span class="k">if</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span><span class="o">.</span><span class="n">v</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mid_next</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span><span class="o">.</span><span class="n">v</span> <span class="o">&lt;=</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid_next</span><span class="o">.</span><span class="n">v</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span><span class="o">.</span><span class="nb">next</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mid_next</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid_next</span><span class="o">.</span><span class="n">v</span> <span class="o">&lt;=</span> <span class="n">num</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid_next</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mid_next</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># 从一个中位数变为两个</span>
                <span class="k">if</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span><span class="o">.</span><span class="n">v</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mid_next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span><span class="o">.</span><span class="n">pre</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mid_next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span><span class="o">.</span><span class="nb">next</span>

    <span class="k">def</span> <span class="nf">findMedian</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        :rtype: float
        """</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">odd</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span><span class="o">.</span><span class="n">v</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mid</span><span class="o">.</span><span class="n">v</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span><span class="o">.</span><span class="nb">next</span><span class="o">.</span><span class="n">v</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p> 
 
 
 
33行还是按照插入排序从末尾开始向前遍历，但是因为我们有中位数
，那么就可以与中位数进行比较，然后减少一半的时间。</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75</pre></td><td class="code"><pre> 
<span class="k">class</span> <span class="nc">MedianFinder2</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        initialize your data structure here.
        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mid</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">odd</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">addNum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="s">"""
        :type num: int
        :rtype: void
        """</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mid</span> <span class="o">=</span> <span class="n">Linker</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mid_next</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">odd</span> <span class="o">=</span> <span class="bp">True</span>  <span class="c"># 是否增加了计数个</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">odd</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">odd</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span>
            <span class="n">tmp_next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span><span class="o">.</span><span class="nb">next</span>
            <span class="k">if</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span><span class="o">.</span><span class="n">v</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">tmp</span> <span class="ow">and</span> <span class="n">tmp</span><span class="o">.</span><span class="n">v</span> <span class="o">&gt;</span> <span class="n">num</span><span class="p">:</span>
                    <span class="n">tmp_next</span> <span class="o">=</span> <span class="n">tmp</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">pre</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">tmp_next</span> <span class="ow">and</span> <span class="n">tmp_next</span><span class="o">.</span><span class="n">v</span> <span class="o">&lt;=</span> <span class="n">num</span><span class="p">:</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp_next</span>
                    <span class="n">tmp_next</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="nb">next</span>

            <span class="n">linker</span> <span class="o">=</span> <span class="n">Linker</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">tmp</span> <span class="ow">and</span> <span class="n">tmp_next</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">tmp</span><span class="o">.</span><span class="nb">next</span> <span class="o">=</span> <span class="n">linker</span>
                <span class="n">linker</span><span class="o">.</span><span class="n">pre</span> <span class="o">=</span> <span class="n">tmp</span>
            <span class="k">elif</span> <span class="n">tmp</span> <span class="ow">and</span> <span class="n">tmp_next</span><span class="p">:</span>
                <span class="n">tmp</span><span class="o">.</span><span class="nb">next</span> <span class="o">=</span> <span class="n">linker</span>
                <span class="n">linker</span><span class="o">.</span><span class="n">pre</span> <span class="o">=</span> <span class="n">tmp</span>
                <span class="n">linker</span><span class="o">.</span><span class="nb">next</span> <span class="o">=</span> <span class="n">tmp_next</span>
                <span class="n">tmp_next</span><span class="o">.</span><span class="n">pre</span> <span class="o">=</span> <span class="n">linker</span>
            <span class="k">elif</span> <span class="n">tmp</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">tmp_next</span><span class="p">:</span>
                <span class="n">linker</span><span class="o">.</span><span class="nb">next</span> <span class="o">=</span> <span class="n">tmp_next</span>
                <span class="n">tmp_next</span><span class="o">.</span><span class="n">pre</span> <span class="o">=</span> <span class="n">linker</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">odd</span><span class="p">:</span>
                <span class="c"># 从两个中位数变为一个</span>
                <span class="k">if</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span><span class="o">.</span><span class="n">v</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mid_next</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span><span class="o">.</span><span class="n">v</span> <span class="o">&lt;=</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid_next</span><span class="o">.</span><span class="n">v</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span><span class="o">.</span><span class="nb">next</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mid_next</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid_next</span><span class="o">.</span><span class="n">v</span> <span class="o">&lt;=</span> <span class="n">num</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid_next</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mid_next</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># 从一个中位数变为两个</span>
                <span class="k">if</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span><span class="o">.</span><span class="n">v</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mid_next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span><span class="o">.</span><span class="n">pre</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mid_next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span><span class="o">.</span><span class="nb">next</span>

    <span class="k">def</span> <span class="nf">findMedian</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        :rtype: float
        """</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">odd</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span><span class="o">.</span><span class="n">v</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mid</span><span class="o">.</span><span class="n">v</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span><span class="o">.</span><span class="nb">next</span><span class="o">.</span><span class="n">v</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p> 
 
 
 
修改后的还是快了一倍的时间，但是还是超时了。无法通过。</p>

<h2 id="-最终解法要用堆"><a name="hh3"></a> 最终解法要用堆</h2>
<p> 
 
 
 
还是用笔在纸上把问题重新描述一下吧。通常非常管用。
<strong>既然题目要求得到中位数，那么其实并没有要求对所有的数字进行排序。
而且又要快速的取得中间值，那么最大最小堆是最接近的。</strong>
往堆里插入一个数字的时间复杂度是<code class="highlighter-rouge">O(lgN)</code>，而取最小值的操作为<code class="highlighter-rouge">O(1)</code>。
总的时间复杂度是<code class="highlighter-rouge">O(NlgN)</code>。嗯，比前面的<code class="highlighter-rouge">O(N**2)</code>肯定是要快的。
但是堆只能取最大或最小的值，怎么取中间值呢？哈哈，把数字一分为二，
使用两个堆就解决了。如果数字从小到大排列，那么前一半用一个最大堆，
后一般用一个最小堆。以下是通过的代码。</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre></td><td class="code"><pre> 
<span class="kn">from</span> <span class="nn">heapq</span> <span class="kn">import</span> <span class="n">heappush</span><span class="p">,</span><span class="n">heappushpop</span>
<span class="k">class</span> <span class="nc">MedianFinder3</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        initialize your data structure here.
        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># 从小到mid；最大堆</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># 从 mid+1 到大 ,最小堆</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">odd</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">addNum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="s">"""
        :type num: int
        :rtype: void
        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">odd</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">odd</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">odd</span> <span class="p">:</span>
                <span class="k">if</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span>
                    <span class="n">heappush</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">num</span><span class="p">)</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">heappushpop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
                    <span class="n">heappush</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">v</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="k">if</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">heappushpop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">num</span><span class="p">)</span>
                    <span class="n">heappush</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">v</span><span class="p">)</span>
                <span class="k">elif</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span>
                    <span class="n">heappush</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">num</span> <span class="p">:</span>
                    <span class="n">heappush</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">findMedian</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        :rtype: float
        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">odd</span> <span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">2.0</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h2 id="-吐槽"><a name="hh4"></a> 吐槽</h2>

<p> 
 
 
 python只默认实现了一个最小堆。想要一个最大堆，还得像第<code class="highlighter-rouge">23</code>行
代码那样使用一种取负数技巧。虽然<code class="highlighter-rouge">heapq</code>模块里有一个构造最大堆的方法
<code class="highlighter-rouge">_heapify_max()</code>但是却没有<code class="highlighter-rouge">_heappushpop_max</code>这样的方法。真是无语啊。</p>


  </div>

  
</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">3.λ｜形而下技术博客</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>
            
              3.λ｜形而下技术博客
            
            </li>
            
            <li><a href="mailto:alenym@qq.com">alenym@qq.com</a></li>
            
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/yanggeorge"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">yanggeorge</span></a>

          </li>
          

          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>这里只关注技术实现，用代码说话。</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
